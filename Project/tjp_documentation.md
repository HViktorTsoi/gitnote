地图 GPS映射方法

通过LiDAR mapping构建的点云地图为局部坐标系, 以建图起点为坐标原点; 而车辆后续的导航规划任务,通常需要WGS84全局坐标, 因此需要将局部地图对齐到GPS所对应的世界坐标系下, 获取到地理参考地图, 在此地图上定位得到的车辆位置和姿态即为GPS全局坐标.

将局部坐标系地图对齐到世界坐标系, 需要求解两坐标系之间的相对位姿变换, 其具体方法为: 车辆在GNSS信号及RTK状态良好的区域多次行驶8字轨迹, 在此过程中,通过组合惯导持续采集高精度GPS轨迹坐标序列P_w,并通过[前文]的激光雷达点云定位方法, 获取车辆在局部地图中的轨迹坐标序列P_l. 由于两类坐标的采样频率不一致, 需要通过坐标的采样时间戳将其对齐, 保证序列长度相等, 并且每两组位置点之间的对应关系是一致的. 应用Umeyama的方法, 求解两组轨迹之间的相对位姿变换参数T, 该算法的目标是计算一组T = [R,t]使目标函数最优：

其中p_i是GPS轨迹中的坐标点,q_i是点云定位轨迹中的坐标点, n为轨迹中的总采样点数量, c为缩放因子, 通常取1. 通过SVD分解方法求解出R和t之后, 即可使目标函数最小化, 此时GPS与点云定位轨迹重合度达到最高, 并且T就对应着局部坐标系到GPS世界坐标系的变换. 

上述映射标定过程只需要在局部点云地图构建完成后进行一次, 在获取到局部-全局转换参数T后, 将其作为地图的元信息, 与几何点一起存储, 即实现几何地图的地理坐标系参考. 在后续的定位过程中, 车辆利用[前文]的方法获取到局部地图内的位姿, 通过左乘局部全局转换参数T得到世界坐标系下的全局位姿, 再通过直角坐标-大地测量坐标投影变换, 得到WGS84定位坐标.

这一参数即局部坐标系到世界坐标系的变换矩阵.

定位过程


Umeyama算法是为了计算两组数据之间的位置关系，比如说，现在有两组位于不同坐标系下的点位数据（可以是2D，也可是是3D），若事先已经知道点位之间的对应关系，则利用Umeyama·算法可以计算出两组数据间的旋转与平移矩阵

该算法的目标是计算一组R,t使目标函数最优：

从该目标函数公式上可以看出，最终的判断标准是距离的平方和，也就是一个最小二乘估计问题，仔细看看，是不是与icp的损失函数是一样的；
具体推导公式就不做累述了，若后期有需求，会添加。
最终计算的结果为：